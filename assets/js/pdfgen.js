function generatePDF() {
  const totalFees = students.reduce((acc, student) => acc + parseInt(student.paymentAmount), 0);
  const studentsPaid = students.length;
  const totalPending = students.filter(student => student.paymentType !== 'Full').length;
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const logoUrl = 'http://localhost/feeforum/assets/img/logo.png';
  const imgWidth = 40;
  const imgHeight = 30;
  doc.addImage(logoUrl, 'PNG', 10, 10, imgWidth, imgHeight);
  doc.setFontSize(22);
  doc.setFont("Helvetica", "bold");
  doc.setTextColor(7, 8, 75);
  doc.text("EYN LCC NO.2 GASHALA", 48, 22);
  doc.setFontSize(18);
  doc.setFont("Helvetica", "normal");
  doc.text("SCHOOL FEES REPORT FOR :", 48, 28);
  doc.setFontSize(12);
  doc.setFont("Helvetica", "normal");
  doc.text('Total paid: '+ studentsPaid,54,33);
  doc.text('Partially paid: ' + totalPending,120,33);
  doc.setFontSize(12);
  doc.setFont("Helvetica", "normal");
  doc.text(`Total: ${totalFees.toLocaleString()}`,54,40);
  const table = document.getElementById("reportTable");
  const tableRows = [];
  const headers = [];
  const tableHeaderCells = table.querySelectorAll("thead tr th");
  tableHeaderCells.forEach(headerCell => {
    headers.push(headerCell.textContent);
  });

  const tableDataRows = table.querySelectorAll("tbody tr");
  tableDataRows.forEach(row => {
    const rowData = [];
    const cells = row.querySelectorAll("td");
    cells.forEach(cell => {
      rowData.push(cell.textContent);
    });
    tableRows.push(rowData);
  });
  doc.autoTable({
    head: [headers],
    body: tableRows,
    startY: 42
  });
  const pageHeight = doc.internal.pageSize.height;
  let finalY = doc.autoTable.previous.finalY || 42; 
  if (finalY + 40 > pageHeight) {
    doc.addPage();
    finalY = 10;
  }
  const generator = prompt('What is your name ?');
  doc.setFont("Helvetica", "normal");
  doc.setFontSize(14);
  doc.setTextColor(11, 145, 223);
  doc.text("Generated by School System", 28, pageHeight - 20);
  doc.text('Accountant :' + generator,28,pageHeight - 15);
  doc.text("Date: " + new Date().toLocaleDateString(), 28, pageHeight - 10);
  const pdfName = prompt('Name your report?');
  doc.save(pdfName + '.pdf');
}


function printPersonalStudentReceipt(studentId){
  const i = getPosition(studentId)
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const pageWidth = doc.internal.pageSize.width;
  const logoUrl = 'http://localhost/feeforum/assets/img/logo.png';
  const balance = getBalance(students[i].uid);
const imgWidth = 40;
const imgHeight = 30;
doc.addImage(logoUrl, 'PNG', 18, 5, imgWidth, imgHeight);
  doc.setFont('Times','bold');
  doc.setFontSize(20);
  doc.setTextColor(4, 6, 64);
  doc.text('LAKE WOOD ACADEMY',63,15);
  doc.line(63,16.7,146,16.7);
  doc.setFont('Helvetica','normal');
  doc.setFontSize(14);
  doc.text('Serial: ',150,30);
  doc.setFont('Times','bold')
  doc.setTextColor(255, 0, 128);
  doc.text(students[i].uid,165,30);
  doc.setFont('Helvetica','normal');
  doc.setTextColor(0, 102, 255);
  doc.setFontSize(11);
  doc.text('ADDRESS: NORTHRIFT HIGHWAY 00876 STREET',63,23);
  doc.setFont('Helvetica','normal');
  doc.setFontSize(18);
  doc.setTextColor(10, 39, 102);
  doc.text('SCHOOL FEES RECEIPT ',63,30);
  doc.setFontSize(14);
  doc.text('Date :',65,37);
  doc.text(students[i].datepaid,84,36.4);
  doc.line(79,37,pageWidth-18,37);
  doc.text("Pupil's name:",18,45);
  doc.text(students[i].name,53,44);
  doc.line(47.5,45,pageWidth-18,45);
  doc.text("Grade :",18,53);
  doc.text(students[i].grade,37,52);
  doc.line(35,53,73,53);
  doc.text("Admission no:",75,53);
  doc.text(students[i].payerregno,112,52);
  doc.line(106.8,53,pageWidth-18,53);
  doc.text("The sum of cash(in words):",18,61);
  doc.text(getWords(`${students[i].amountpaid}`),83,60);
  doc.line(78,61,pageWidth-18,61);
  doc.line(18,69,pageWidth-18,69);
var columns = [
  { header: '', dataKey: 'ass' },
{ header: 'BEING PAYMENT OF:', dataKey: 'paymentReason'},
{ header: 'AMOUNT', dataKey: 'amount' }
];
var rows = [
{ paymentReason: 'Admission', amount: 275,  },
{ paymentReason: 'School Fees', amount: 3700,  },
{ paymentReason: 'School Bus', amount: 2782 },
{ paymentReason: 'Diary', amount: 2232 },
{ paymentReason: 'Lunch', amount: 2092 },
{ paymentReason: 'Computer', amount: 282 },
{ paymentReason: 'Examination', amount: 2290 },
{ paymentReason: 'Tour', amount: 2672 },
{ paymentReason: 'Medical', amount: 2452 },
{ paymentReason: 'Graduation', amount: 2267 },
{ paymentReason: 'Total', amount: students[i].amountpaid}
];
doc.autoTable({
columns: columns,
body: rows,
startY: 74, 
theme: 'grid', 
styles: { fontSize: 10 },
headStyles: { fillColor: [255,255,255] ,textColor: [39,44,102],lineColor: [0, 102, 255],lineWidth: 0.25},
bodyStyles: { fillColor: [255, 255, 255,],fontSize: [14],lineColor: [0, 102, 255],lineWidth: 0.325},
columnStyles: { 0: { cellWidth: 10 } },
});
  doc.setFontSize(14);
  const pageHeight = doc.internal.pageSize.height;
  let finalY = doc.autoTable.previous.finalY || 42;
  doc.setFont('Helvetica','italic');
  doc.text('Cash|Cheque|Direct Deposit',70,finalY+20);
  doc.setFont('Helvetica','normal');
  doc.text('Balance :',10,finalY+32); 
  doc.text(balance,32,finalY+31);
  doc.line(30.7,finalY+32,95,finalY+32);
  doc.setFontSize(16);
  doc.setTextColor(0, 102, 255);
  doc.text('WWW.LAKE WOOD ACADEMY.COM',10,finalY+40);
  doc.text('+100222555456',65,finalY+48);
  doc.line(140,finalY+40,198,finalY+40);
  doc.setFontSize(18);
  doc.setTextColor(39,44,102);
  doc.text('SCHOOL STAMP',145,finalY+46.7);
  doc.addImage(logoUrl, 'PNG', 150, finalY+5, imgWidth, imgHeight);
  doc.save(students[i].name+"-"+students[i].grade+"-"+students[i].datepaid+".pdf");
}

function getBalance(paymentId){
  const student = students.find(student => student.paymentId === paymentId);
  var total = getFullPayment(students[i].grade);
  var balance = total - students[i].amountpaid;
  if (balance <= 0){
    const output = "Nill";
    return output;
  } else {
    const output = `${balance}`; 
    return output;
  }
}